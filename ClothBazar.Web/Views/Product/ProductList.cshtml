@model ProductSearchViewModels

<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"/>
<script src="//cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>

@*<script src="~/Scripts/jquery-1.10.2.js"></script>*@

<div id="tableContiner">

    <div>
        <form class="form-inline" method="post">
            <div class="form-group mb-2 ml-5">
                <input id="searchtxt" class="ml-1" name="Search" value="@Model.SearchTerm" />
                <button class="ml-1" type="button" id="search">Search</button>
                <button class="ml-2" id="NewBtn" type="button">New</button>
            </div>
        </form>
    </div>
    <div >
        <table id="ProductsTable" class="table table-striped">
            <thead>
                <tr>
                    <td>Product Name</td>
                    <td>Category</td>
                    <td>Price</td>
                    <td class="wrap-td">Actions</td>
                </tr>
            </thead>
            <tbody>
                @if (Model.Products != null && Model.Products.Count > 0)
            {
                foreach (var product in Model.Products)
                {
                        <tr>
                            <td>@product.Name</td>
                            <td>
                                @if (product.Category != null)
                                {
                                    <text>@product.Category.Name</text>
                                }
                                else
                                {
                                    <text>-</text>
                                }
                            </td>
                            <td>@product.Price</td>
                            <td class="wrap-td">
                                <button class="EditBtn" data-id="@product.ID">Edit</button>
                                <button class="DelBtn" data-id="@product.ID">Delete</button>
                                <button class="addtoCart" data-id="@product.ID">Add To Card</button>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-danger">No Product found.</td>
                    </tr>
                }
            </tbody>
        </table>
        @*<div>
            <button class="pageRecords" data-pageNo="@(Model.pageNo - 1)">Previous</button>
            <button class="pageRecords" data-pageNo="@(Model.pageNo + 1)">Next</button>
        </div>*@
    </div>
  
</div>
<div id="AddProductCon">

</div>


<script>

        $('#ProductsTable').DataTable();


    $(".pageRecords").click(function () {
        $.ajax({
            url: '/Product/ProductList',
            data: {
                pageNo: $(this).attr("data-pageNo")
            }
        })
        .done(function (response) {
            $("#tableContiner").html(response);
        })

        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
            alert("FAIL");
        })
    });



    $("#search").click(function () {
        var txtvalue = $("#searchtxt").val();
        $.ajax({
            url: '/Product/ProductList',
            data: {
                search: txtvalue
            }
        }).done(function (data) {

            $("#tableContiner").html(data);
            //alert(data);
        }).fail(function (XMLHttpRequest, textStatus, errorThrown) {
            alert("FAIL");
        })

    });

    $("#NewBtn").click(function () {
        $.ajax({
            url: '/Product/Create'
        })
        .done(function (response) {
            $("#AddProductCon").html(response);
            focusAction();
        })

        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
            alert("FAIL");
        })
    });

    $(".EditBtn").click(function () {
        $.ajax({
            url: '/Product/Edit',
            data: {
                ID: $(this).attr('data-id')
            }
        })
        .done(function (response) {
            $("#AddProductCon").html(response);

            focusAction();
        })
        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
            alert("FAIL");
        })
    });

    $(".DelBtn").click(function () {

            swal({
                title: "Are you sure?",
                text: "Are you sure you want to delete this product?",
                icon: "warning",
                buttons: true,
                dangerMode: true,
            })
            .then((willDelete) => {
                if (willDelete) {
                 
                        $.ajax({
                            type: 'POST',
                            url: '/Product/Delete',
                            data: {
                                ID: $(this).attr('data-id')
                            }
                        })
                        .done(function (response) {
                            $("#tableContiner").html(response);
                            swal("Record deleted Successfully.!", {
                                icon: "success",
                        })
                        .fail(function (XMLHttpRequest, textStatus, errorThrown) {
                            alert("FAIL");
                        })

                    });
                } 
            });

        //var confirmsms = confirm("Are you sure you want to delete this product?");

        //if (confirmsms) {
        //    $.ajax({
        //        type: 'POST',
        //        url: '/Product/Delete',
        //        data: {
        //            ID: $(this).attr('data-id')
        //        }
        //    })
        //   .done(function (response) {
        //       $("#tableContiner").html(response);
        //   })
        //   .fail(function (XMLHttpRequest, textStatus, errorThrown) {
        //       alert("FAIL");
        //   })
        //}

    });

    var products = [];
    $(".addtoCart").click(function () {

        var productID = $(this).attr('data-id');
        products.push(productID);
        $.cookie('CartProducts', products.join('-'), { path: '/' });
        alert('Product Addd to Cart.');
    });


    function focusAction() {

        $('html , body').animate({
            scrollTop: $("#AddProductCon").offset().top - 100
        }, 1000);
    }
</script>



